const he=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))y(t);new MutationObserver(t=>{for(const u of t)if(u.type==="childList")for(const s of u.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&y(s)}).observe(document,{childList:!0,subtree:!0});function o(t){const u={};return t.integrity&&(u.integrity=t.integrity),t.referrerpolicy&&(u.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?u.credentials="include":t.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function y(t){if(t.ep)return;t.ep=!0;const u=o(t);fetch(t.href,u)}};he();const T=[["C2",65.41],["C#2/Db2",69.3],["D2",73.42],["D#2/Eb2",77.78],["E2",82.41],["F2",87.31],["F#2/Gb2",92.5],["G2",98],["G#2/Ab2",103.83],["A2",110],["A#2/Bb2",116.54],["B2",123.47],["C3",130.81],["C#3/Db3",138.59],["D3",146.83],["D#3/Eb3",155.56],["E3",164.81],["F3",174.61],["F#3/Gb3",185],["G3",196],["G#3/Ab3",207.65],["A3",220],["A#3/Bb3",233.08],["B3",246.94],["C4",261.63],["C#4/Db4",277.18],["D4",293.66],["D#4/Eb4",311.13],["E4",329.63],["F4",349.23],["F#4/Gb4",369.99],["G4",392],["G#4/Ab4",415.3],["A4",440],["A#4/Bb4",466.16],["B4",493.88],["C5",523.25],["C#5/Db5",554.37],["D5",587.33],["D#5/Eb5",622.25],["E5",659.25],["F5",698.46],["F#5/Gb5",739.99],["G5",783.99],["G#5/Ab5",830.61],["A5",880],["A#5/Bb5",932.33],["B5",987.77]];var S=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},A={},Q={},U=S&&S.__assign||function(){return U=Object.assign||function(n){for(var r,o=1,y=arguments.length;o<y;o++){r=arguments[o];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n},U.apply(this,arguments)};Object.defineProperty(Q,"__esModule",{value:!0});var ue={threshold:.1,sampleRate:44100,probabilityThreshold:.1};function ge(n){n===void 0&&(n={});var r=U(U({},ue),n),o=r.threshold,y=r.sampleRate,t=r.probabilityThreshold;return function(s){var e;for(e=1;e<s.length;e*=2);e/=2;for(var g=e/2,l=new Float32Array(g),M=0,c,a=0;a<g;a++)l[a]=0;for(var a=1;a<g;a++)for(var b=0;b<g;b++){var _=s[b]-s[b+a];l[a]+=_*_}l[0]=1,l[1]=1;for(var d=0,a=1;a<g;a++)d+=l[a],l[a]*=a/d;for(c=2;c<g;c++)if(l[c]<o){for(;c+1<g&&l[c+1]<l[c];)c++;M=1-l[c];break}if(c===g||l[c]>=o||M<t)return null;var p,i,h;if(c<1?i=c:i=c-1,c+1<g?h=c+1:h=c,i===c)l[c]<=l[h]?p=c:p=h;else if(h===c)l[c]<=l[i]?p=c:p=i;else{var v=l[i],f=l[c],m=l[h];p=c+(m-v)/(2*(2*f-m-v))}return y/p}}Q.YIN=ge;var K={},I=S&&S.__assign||function(){return I=Object.assign||function(n){for(var r,o=1,y=arguments.length;o<y;o++){r=arguments[o];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n},I.apply(this,arguments)};Object.defineProperty(K,"__esModule",{value:!0});var me={sampleRate:44100,minFrequency:82,maxFrequency:1e3,ratio:5,sensitivity:.1};function ye(n){n===void 0&&(n={});var r=I(I({},me),n),o=r.sampleRate,y=r.minFrequency,t=r.maxFrequency,u=r.sensitivity,s=r.ratio,e=[],g=Math.ceil(o/y),l=Math.floor(o/t);return function(c){var a=c.length,b=0,_=1/0,d=-1/0,p,i,h,v,f,m,F,L;for(v=0;v<a;v++)if(l<=v&&v<=g){for(F=0,L=v,b=0,p=[],i=[];F<a-v;b++,L++,F++)p[b]=c[F],i[b]=c[L];var w=p.length;for(h=[],m=0;m<w;m++)h[m]=p[m]-i[m];var R=0;for(m=0;m<w;m++)R+=Math.abs(h[m]);e[v]=R}for(f=l;f<g;f++)e[f]<_&&(_=e[f]),e[f]>d&&(d=e[f]);var O=Math.round(u*(d-_)+_);for(f=l;f<=g&&e[f]>O;f++);var x=l/2;_=e[f];var E=f;for(v=f-1;v<f+x&&v<=g;v++)e[v]<_&&(_=e[v],E=v);return Math.round(e[E]*s)<d?o/E:null}}K.AMDF=ye;var V={},G=S&&S.__assign||function(){return G=Object.assign||function(n){for(var r,o=1,y=arguments.length;o<y;o++){r=arguments[o];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n},G.apply(this,arguments)};Object.defineProperty(V,"__esModule",{value:!0});var re={sampleRate:44100};function pe(n){n===void 0&&(n=re);var r=G(G({},re),n),o=r.sampleRate;return function(t){var u=t.length,s=0,e,g,l,M;for(e=0;e<u;e++)M=t[e],s+=M*M;if(s=Math.sqrt(s/u),s<.01)return-1;var c=0,a=u-1,b=.2;for(e=0;e<u/2;e++)if(Math.abs(t[e])<b){c=e;break}for(e=1;e<u/2;e++)if(Math.abs(t[u-e])<b){a=u-e;break}var _=t.slice(c,a),d=_.length,p=new Array(d).fill(0);for(e=0;e<d;e++)for(g=0;g<d-e;g++)p[e]=p[e]+_[g]*_[g+e];for(l=0;p[l]>p[l+1];)l++;var i=-1,h=-1;for(e=l;e<d;e++)p[e]>i&&(i=p[e],h=e);var v=h,f=p[v-1],m=p[v],F=p[v+1],L=(f+F-2*m)/2,w=(F-f)/2;return L&&(v=v-w/(2*L)),o/v}}V.ACF2PLUS=pe;var J={},z=S&&S.__assign||function(){return z=Object.assign||function(n){for(var r,o=1,y=arguments.length;o<y;o++){r=arguments[o];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n},z.apply(this,arguments)};Object.defineProperty(J,"__esModule",{value:!0});var be=6,de=3e3,_e=3,Me=.75,Fe={sampleRate:44100};function Le(n){n===void 0&&(n={});var r=z(z({},Fe),n),o=r.sampleRate;return function(t){for(var u=[],s=[],e=t.length,g=null,l=0,M=0,c=0,a=0;a<e;a++){var b=t[a];l=l+b,c=Math.max(c,b),M=Math.min(M,b)}l/=e,M-=l,c-=l;for(var _=c>-1*M?c:-1*M,d=_*Me,p=0,i=-1,h=t.length,v,f,m;v=~~(o/(Math.pow(2,p)*de)),!(h<2);){var F=void 0,L=-1e3,w=-1e6,R=-1e6,O=!1,x=!1;m=0,f=0;for(var a=2;a<h;a++){var E=t[a]-l,k=t[a-1]-l;k<=0&&E>0&&(O=!0),k>=0&&E<0&&(x=!0),F=E-k,L>-1e3&&(x&&L<0&&F>=0&&Math.abs(E)>=d&&a>w+v&&(u[m++]=a,w=a,x=!1),O&&L>0&&F<=0&&Math.abs(E)>=d&&a>R+v&&(s[f++]=a,R=a,O=!1)),L=F}if(m===0&&f===0)break;for(var B=void 0,N=[],a=0;a<h;a++)N[a]=0;for(var a=0;a<m;a++)for(var P=1;P<_e;P++)a+P<m&&(B=Math.abs(u[a]-u[a+P]),N[B]+=1);for(var q=-1,W=-1,a=0;a<h;a++){for(var C=0,P=-1*v;P<=v;P++)a+P>=0&&a+P<h&&(C+=N[a+P]);C===W?a===2*q&&(q=a):C>W&&(W=C,q=a)}for(var j=0,ee=0,P=-v;P<=v;P++)if(q+P>=0&&q+P<e){var X=N[q+P];X>0&&(ee+=X,j+=(q+P)*X)}if(j/=ee,i>-1&&Math.abs(j*2-i)<=2*v){g=o/(Math.pow(2,p-1)*i);break}if(i=j,p++,p>=be||h<2)break;var $=t.subarray(0);h===N.length&&($=new Float32Array(h/2));for(var a=0;a<h/2;a++)$[a]=(t[2*a]+t[2*a+1])/2;t=$,h/=2}return g}}J.DynamicWavelet=Le;var Z={},Y=S&&S.__assign||function(){return Y=Object.assign||function(n){for(var r,o=1,y=arguments.length;o<y;o++){r=arguments[o];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n},Y.apply(this,arguments)};Object.defineProperty(Z,"__esModule",{value:!0});var Pe={bufferSize:1024,cutoff:.97,sampleRate:44100};function De(n){n===void 0&&(n={});var r=Y(Y({},Pe),n),o=r.bufferSize,y=r.cutoff,t=r.sampleRate,u=.5,s=80,e=new Float32Array(o),g=new Float32Array(o),l,M,c=[],a=[],b=[];function _(i){var h,v;g[0]=i[0]*i[0];for(var f=1;f<i.length;f+=1)g[f]=i[f]*i[f]+g[f-1];for(var m=0;m<i.length;m++){h=0,v=g[i.length-1-m]+g[i.length-1]-g[m];for(var f=0;f<i.length-m;f++)h+=i[f]*i[f+m];e[m]=2*h/v}}function d(i){var h=e[i-1],v=e[i],f=e[i+1],m=i,F=f+h-2*v;if(F===0)l=m,M=v;else{var L=h-f;l=m+L/(2*F),M=v-L*L/(8*F)}}function p(){for(var i=0,h=0;i<(e.length-1)/3&&e[i]>0;)i++;for(;i<e.length-1&&e[i]<=0;)i++;for(i==0&&(i=1);i<e.length-1;)if(e[i]>e[i-1]&&e[i]>=e[i+1]&&(h==0||e[i]>e[h])&&(h=i),i++,i<e.length-1&&e[i]<=0)for(h>0&&(c.push(h),h=0);i<e.length-1&&e[i]<=0;)i++;h>0&&c.push(h)}return function(h){var v;c=[],a=[],b=[],_(h),p();for(var f=-1/0,m=0;m<c.length;m++){var F=c[m];f=Math.max(f,e[F]),e[F]>u&&(d(F),b.push(M),a.push(l),f=Math.max(f,M))}if(a.length){for(var L=y*f,w=0,m=0;m<b.length;m++)if(b[m]>=L){w=m;break}var R=a[w],O=t/R;O>s?v=O:v=-1}else v=-1;return{probability:f,freq:v}}}Z.Macleod=De;var te={};(function(n){var r=S&&S.__assign||function(){return r=Object.assign||function(t){for(var u,s=1,e=arguments.length;s<e;s++){u=arguments[s];for(var g in u)Object.prototype.hasOwnProperty.call(u,g)&&(t[g]=u[g])}return t},r.apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0}),n.DEFAULT_FREQUENCIES_PARAMS={tempo:120,quantization:4,sampleRate:44100};function o(t,u){var s=t.map(function(b){return b(u)}).filter(function(b){return b!==null}).sort(function(b,_){return b-_});if(s.length===1)return s[0];if(s.length===2){var e=s[0],g=s[1];return e*2>g?Math.sqrt(e*g):e}else{var e=s[0],g=s[1],l=s[s.length-2],M=s[s.length-1],c=e*2>g?s:s.slice(1),a=l*2>M?c:c.slice(0,-1);return Math.pow(a.reduce(function(d,p){return d*p},1),1/a.length)}}function y(t,u,s){s===void 0&&(s={});var e=r(r({},n.DEFAULT_FREQUENCIES_PARAMS),s),g=e.tempo,l=e.quantization,M=e.sampleRate,c=u.length,a=Math.round(M*60/(l*g)),b;Array.isArray(t)?b=o.bind(null,t):b=t;for(var _=[],d=0,p=c-a;d<=p;d+=a){var i=u.slice(d,d+a),h=b(i);_.push(h)}return _}n.frequencies=y})(te);Object.defineProperty(A,"__esModule",{value:!0});var ae=Q;A.YIN=ae.YIN;var ne=K,Se=A.AMDF=ne.AMDF,ie=V;A.ACF2PLUS=ie.ACF2PLUS;var oe=J;A.DynamicWavelet=oe.DynamicWavelet;var ce=Z;A.Macleod=ce.Macleod;var se=te;A.frequencies=se.frequencies;A.default={YIN:ae.YIN,AMDF:ne.AMDF,ACF2PLUS:ie.ACF2PLUS,DynamicWavelet:oe.DynamicWavelet,Macleod:ce.Macleod,frequencies:se.frequencies};const we=async()=>{const n=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new window.AudioContext,o=r.createMediaStreamSource(n),y=r.createScriptProcessor(0,1,1);o.connect(y),y.connect(r.destination);const t=[];return y.onaudioprocess=s=>{const e=s.inputBuffer.getChannelData(0),g=Se({minFrequency:T[0][1],sampleRate:r.sampleRate,maxFrequency:T.at(-1)[1]})(e);g&&t.forEach(l=>l(g))},{addPitchListener:s=>{typeof s=="function"&&t.push(s)}}},Ee=T[0][1],Oe=T.at(-1)[1],le=n=>r=>r.pitchLines.highestOnTop?Math.log2(Oe)*r.pitchLines.baseDistance-Math.log2(n)*r.pitchLines.baseDistance+r.pitchLines.offset.y:Math.log2(n)*r.pitchLines.baseDistance-Math.log2(Ee)*r.pitchLines.baseDistance+r.pitchLines.offset.y,Ae={pitchSize:{width:5,height:2},lastPitch:{color:"",position:{x:0,y:0}},pitchLines:{offset:{x:70,y:50},baseDistance:300,highestOnTop:!0}},ve={value:Ae},Re=n=>{ve.value=n},H=()=>ve.value,qe=n=>T.some(r=>{const[o,y]=r;return Math.abs(y-n)<=.017*y}),Te=(n,r)=>o=>{const{lastPitch:y,pitchSize:t,pitchLines:u}=o,s=y.position.x<u.offset.x?u.offset.x:y.position.x+t.width;return{...o,lastPitch:{position:{x:s>r?u.offset.x:s,y:le(n)(o)-t.height/2},color:qe(n)?"green":"red"}}},xe="/pitchmonitor/assets/pitchmonitor.151288b6.svg";document.querySelector("#app").innerHTML=`
  <div>
    <h1>Pitch Monitor <img src="${xe}" height="48" width="48"></h1>
    <div>last pitch: <span id="pitch">N/A</span></div>
    <canvas height=1300 />
  </div>
`;const D=document.querySelector("canvas").getContext("2d");D.canvas.width=window.innerWidth;const Ne=n=>{D.fillStyle="blue",D.font="10px",T.forEach(r=>{const[o,y]=r,t=le(y)(n);D.fillText(o,8,t),D.fillRect(n.pitchLines.offset.x,t,D.canvas.width,1)})},fe=n=>{D.fillStyle="white",D.fillRect(0,0,D.canvas.width,D.canvas.height),Ne(n)},Ce=n=>{const{lastPitch:r,pitchSize:o,pitchLines:y}=n;r.position.x===y.offset.x&&fe(n),D.fillStyle=r.color,D.fillRect(r.position.x,r.position.y,o.width,o.height)};fe(H());we().then(n=>{n.addPitchListener(r=>{document.getElementById("pitch").innerHTML=r,Re(Te(r,D.canvas.width)(H())),Ce(H())})});
